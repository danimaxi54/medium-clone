import {
  useEffect,
  useState
} from "react";
import { Link } from "react-router-dom";

import useFetch from 'hooks/useFetch';

const Comment = ({
  slug,
  comment,
  isAuthor,
  doFetchComments
}) => {
  const apiUrl = `/articles/${slug}/comments/${comment.id}`
  const [{ isLoading }, doDeleteComment] = useFetch(apiUrl);
  const [isSuccessfulDelete, setIsSuccessFulDelete] = useState(false);

  const deleteComment = () => {
    doDeleteComment({
      method: 'delete',
    });

    setIsSuccessFulDelete(true);
  };

  useEffect(() => {
    if (isSuccessfulDelete && !isLoading) {
      doFetchComments();
    }
  }, [isSuccessfulDelete, isLoading]);

  return (
    <div className='card'>
      <div className='card-block'>
        <p className='class="card-text"'>
          {comment.body}
        </p>
      </div>
      <div className='card-footer'>
        <Link to={`profile/${comment.author.username}`} className='comment-author'>
          <img className='comment-author-img' src={comment.author.image} alt="" />
        </Link>
        &nbsp; <Link to={`profile/${comment.author.username}`} className='comment-author' >
          {comment.author.username}
        </Link>
        <span className='date-posted'>{comment.createdAt}</span>
        {isAuthor === comment.author.username && (
          <span className='mod-options' onClick={deleteComment}>
            <i className="ion-trash-a" />
          </span>
        )}
      </div>
    </div>
  );
};

export default Comment;