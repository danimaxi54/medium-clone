import {
  Fragment,
  useContext,
  useState
} from "react";

import BackendErrorMessages from 'components/backendErrorMessages';
import { CurrentUserContext } from "contexts/currentUser";

const CommentForm = ({
  isAuthor,
  authorImage,
  doPostComment,
  isLoading,
  errors
}) => {
  const [comment, setComment] = useState('');
  const [{ currentUser }] = useContext(CurrentUserContext);

  const handleSubmit = (e) => {
    e.preventDefault();

    doPostComment({
      method: 'post',
      data: {
        comment: {
          body: comment,
        },
      },
    });

    setComment('');
  };

  return (
    <Fragment>
      {errors && <BackendErrorMessages backendErrors={errors} />}
      <form
        className='card comment-form ng-untouched ng-pristine ng-valid'
        onSubmit={handleSubmit}
      >
        <fieldset>
          <div className='card-block'>
					<textarea
            className='form-control ng-pristine ng-valid ng-touched'
            rows='3'
            disabled={isLoading}
            placeholder='Write a comment...'
            value={comment}
            onChange={(e) => setComment(e.target.value)}
          />
          </div>
        </fieldset>
        <div className='card-footer'>
          <img
            className='comment-author-img'
            src={(!isAuthor && currentUser)
              ? currentUser.image
              : authorImage}
            alt=''
          />
          <button
            className='btn btn-sm btn-primary'
            disabled={isLoading}
            type='submit'
          >
            Post Comment
          </button>
        </div>
      </form>
    </Fragment>
  );
};

export default CommentForm;