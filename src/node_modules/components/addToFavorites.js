import { useContext } from "react";
import classNames from "classnames";

import useFetch from 'hooks/useFetch';
import { CurrentUserContext } from 'contexts/currentUser';

const AddToFavorites = ({
  isFavorited,
  favoritesCount,
  articleSlug,
  text = ''
}) => {
  const apiUrl = `/articles/${articleSlug}/favorite`;
  const [{ response, isLoading }, doFetch] = useFetch(apiUrl);
  const [currentUserState] = useContext(CurrentUserContext);
  const favoritesCountWithResponse = response
    ? response.article.favoritesCount
    : favoritesCount;
  const isFavoritedWithResponse = response
    ? response.article.favorited
    : isFavorited;
  const buttonClasses = classNames({
    'btn': true,
    'btn-sm': true,
    'btn-primary': isFavoritedWithResponse,
    'btn-outline-primary': !isFavoritedWithResponse
  });

  const handleLike = (e) => {
    e.preventDefault();

    if (!currentUserState.isLoggedIn) {
      window.location.href = '/login';

      return;
    }

    doFetch({
      method: isFavoritedWithResponse ? 'delete' : 'post',
    });
  };

  return (
    <button
      className={buttonClasses}
      disabled={isLoading}
      onClick={handleLike}
    >
      <i className='ion-heart' />
      <span>
			  &nbsp;
        {text
          ? `${text} (${favoritesCountWithResponse})`
          : favoritesCountWithResponse}
		</span>
    </button>
  );
};

export default AddToFavorites;